!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}(self.webpackChunkgrocery_ultimate_web_initappz=self.webpackChunkgrocery_ultimate_web_initappz||[]).push([[249],{33249:function(t,i,o){o.r(i),o.d(i,{ChatsModule:function(){return R}});var a=o(38583),r=o(63318),l=o(37716),d=o(5830),s=o(67241),c=o(1078),m=o(90665),u=o(72298),p=["basicModal"],g=["scrollMe"];function v(e,t){if(1&e&&(l.\u0275\u0275elementStart(0,"div",25),l.\u0275\u0275elementStart(1,"div",26),l.\u0275\u0275elementStart(2,"span",27),l.\u0275\u0275text(3),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd()),2&e){var n=l.\u0275\u0275nextContext();l.\u0275\u0275advance(3),l.\u0275\u0275textInterpolate(n.util.translate("Loading..."))}}function f(e,t){if(1&e&&(l.\u0275\u0275elementStart(0,"div",30),l.\u0275\u0275elementStart(1,"div",31),l.\u0275\u0275elementStart(2,"div",32),l.\u0275\u0275elementStart(3,"p"),l.\u0275\u0275text(4),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd()),2&e){var n=l.\u0275\u0275nextContext().$implicit;l.\u0275\u0275advance(4),l.\u0275\u0275textInterpolate(n.message)}}function h(e,t){if(1&e&&(l.\u0275\u0275elementStart(0,"div",33),l.\u0275\u0275elementStart(1,"div",31),l.\u0275\u0275elementStart(2,"div",32),l.\u0275\u0275elementStart(3,"p"),l.\u0275\u0275text(4),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd()),2&e){var n=l.\u0275\u0275nextContext().$implicit;l.\u0275\u0275advance(4),l.\u0275\u0275textInterpolate(n.message)}}function x(e,t){if(1&e&&(l.\u0275\u0275elementStart(0,"span"),l.\u0275\u0275template(1,f,5,1,"div",28),l.\u0275\u0275template(2,h,5,1,"div",29),l.\u0275\u0275elementEnd()),2&e){var n=t.$implicit,i=l.\u0275\u0275nextContext();l.\u0275\u0275advance(1),l.\u0275\u0275property("ngIf",n.from_id!=i.uid),l.\u0275\u0275advance(1),l.\u0275\u0275property("ngIf",n.from_id==i.uid)}}function y(e,t){if(1&e&&(l.\u0275\u0275elementStart(0,"div",34),l.\u0275\u0275elementStart(1,"div",26),l.\u0275\u0275elementStart(2,"span",27),l.\u0275\u0275text(3),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd()),2&e){var n=l.\u0275\u0275nextContext();l.\u0275\u0275advance(3),l.\u0275\u0275textInterpolate(n.util.translate("Loading..."))}}var _=function(){return{"background-image":"url(assets/placeholder.png)"}};function b(e,t){if(1&e){var n=l.\u0275\u0275getCurrentView();l.\u0275\u0275elementStart(0,"div",35),l.\u0275\u0275listener("click",function(){return l.\u0275\u0275restoreView(n),l.\u0275\u0275nextContext().onAdmin()}),l.\u0275\u0275elementStart(1,"div",36),l.\u0275\u0275element(2,"div",37),l.\u0275\u0275elementStart(3,"p",38),l.\u0275\u0275text(4),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd()}if(2&e){var i=l.\u0275\u0275nextContext();l.\u0275\u0275advance(2),l.\u0275\u0275property("ngStyle",l.\u0275\u0275pureFunction0(2,_)),l.\u0275\u0275advance(2),l.\u0275\u0275textInterpolate1(" ",i.util.translate("Support")," ")}}var C=function(e){return{"background-image":e}};function M(e,t){if(1&e){var n=l.\u0275\u0275getCurrentView();l.\u0275\u0275elementStart(0,"div",41),l.\u0275\u0275listener("click",function(){l.\u0275\u0275restoreView(n);var e=l.\u0275\u0275nextContext().$implicit;return l.\u0275\u0275nextContext().onChat(e.participants,e.receiver_type,e.receiver_name+" "+e.receiver_last_name)}),l.\u0275\u0275element(1,"div",37),l.\u0275\u0275elementStart(2,"p",38),l.\u0275\u0275text(3),l.\u0275\u0275element(4,"br"),l.\u0275\u0275elementStart(5,"span",42),l.\u0275\u0275text(6),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd()}if(2&e){var i=l.\u0275\u0275nextContext().$implicit,o=l.\u0275\u0275nextContext();l.\u0275\u0275advance(1),l.\u0275\u0275property("ngStyle",l.\u0275\u0275pureFunction1(3,C,"url("+o.api.mediaURL+i.receiver_cover+")")),l.\u0275\u0275advance(2),l.\u0275\u0275textInterpolate1(" ",i.receiver_name+" "+i.receiver_last_name," "),l.\u0275\u0275advance(3),l.\u0275\u0275textInterpolate(i.receiver_type)}}function E(e,t){if(1&e){var n=l.\u0275\u0275getCurrentView();l.\u0275\u0275elementStart(0,"div",41),l.\u0275\u0275listener("click",function(){l.\u0275\u0275restoreView(n);var e=l.\u0275\u0275nextContext().$implicit;return l.\u0275\u0275nextContext().onChat(e.uid,e.sender_type,e.sender_first_name+" "+e.sender_last_name)}),l.\u0275\u0275element(1,"div",37),l.\u0275\u0275elementStart(2,"p",38),l.\u0275\u0275text(3),l.\u0275\u0275element(4,"br"),l.\u0275\u0275elementStart(5,"span",42),l.\u0275\u0275text(6),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd()}if(2&e){var i=l.\u0275\u0275nextContext().$implicit,o=l.\u0275\u0275nextContext();l.\u0275\u0275advance(1),l.\u0275\u0275property("ngStyle",l.\u0275\u0275pureFunction1(3,C,"url("+o.api.mediaURL+i.sender_cover+")")),l.\u0275\u0275advance(2),l.\u0275\u0275textInterpolate1(" ",i.sender_first_name+" "+i.sender_last_name," "),l.\u0275\u0275advance(3),l.\u0275\u0275textInterpolate(i.sender_type)}}function S(e,t){if(1&e&&(l.\u0275\u0275elementStart(0,"div",39),l.\u0275\u0275template(1,M,7,5,"div",40),l.\u0275\u0275template(2,E,7,5,"div",40),l.\u0275\u0275elementEnd()),2&e){var n=t.$implicit,i=l.\u0275\u0275nextContext();l.\u0275\u0275advance(1),l.\u0275\u0275property("ngIf",i.uid==n.uid),l.\u0275\u0275advance(1),l.\u0275\u0275property("ngIf",i.uid!=n.uid)}}var I=function(){return{"border-radius":"5px",height:"120px",width:"100%"}};function w(e,t){1&e&&(l.\u0275\u0275elementStart(0,"div",45),l.\u0275\u0275element(1,"ngx-skeleton-loader",46),l.\u0275\u0275elementEnd()),2&e&&(l.\u0275\u0275advance(1),l.\u0275\u0275property("theme",l.\u0275\u0275pureFunction0(1,I)))}var k=function(){return[1,2,3,4,5,6,7,8]};function O(e,t){1&e&&(l.\u0275\u0275elementStart(0,"div"),l.\u0275\u0275elementStart(1,"div",43),l.\u0275\u0275template(2,w,2,2,"div",44),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd()),2&e&&(l.\u0275\u0275advance(2),l.\u0275\u0275property("ngForOf",l.\u0275\u0275pureFunction0(1,k)))}var P,F=function(){return{backdrop:!0,ignoreBackdropClick:!0}},j=[{path:"",component:(P=function(){function t(n,i,o){e(this,t),this.api=n,this.util=i,this.router=o,this.dummy=[],this.users=[],this.msg="",this.messages=[],this.receiver_id="",this.roomId="",this.uid=parseInt(localStorage.getItem("uid")),this.getChats()}return n(t,[{key:"ngOnInit",value:function(){}},{key:"getChats",value:function(){var e=this;this.dummy=Array(10),this.api.post_private("v1/chats/getChatListBUid",{id:this.uid}).then(function(t){console.log(t),e.dummy=[],t&&t.status&&t.data&&t.data.length&&(e.users=t.data,console.log("users",e.users))},function(t){console.log(t),e.dummy=[],e.util.apiErrorHandler(t)}).catch(function(t){console.log(t),e.dummy=[],e.util.apiErrorHandler(t)})}},{key:"onAdmin",value:function(){this.messages=[],this.receiver_id=this.util.adminInfo.id,this.name=this.util.adminInfo.first_name+" "+this.util.adminInfo.last_name,this.getInbox(),this.loaded=!1,this.basicModal.show()}},{key:"onChat",value:function(e,t,n){console.log(e,t,n),this.messages=[],this.receiver_id=e,this.name=n,this.getInbox(),this.loaded=!1,this.basicModal.show()}},{key:"getInbox",value:function(){var e=this;this.api.post_private("v1/chats/getChatRooms",{uid:this.uid,participants:this.receiver_id}).then(function(t){console.log(t),t&&t.status&&200===t.status?(t&&t.data&&t.data.id?e.roomId=t.data.id:t&&t.data2&&t.data2.id&&(e.roomId=t.data2.id),e.interval=setInterval(function(){console.log("calling in interval"),e.getChatsList()},12e3),e.getChatsList()):e.createChatRooms()},function(t){console.log("error",t),e.loaded=!1,e.createChatRooms()}).catch(function(t){e.loaded=!1,e.createChatRooms(),console.log("error",t)})}},{key:"createChatRooms",value:function(){var e=this;this.api.post_private("v1/chats/createChatRooms",{uid:this.uid,participants:this.receiver_id,status:1}).then(function(t){console.log(t),e.loaded=!0,t&&t.status&&200===t.status&&t.data&&(e.roomId=t.data.id,e.getChatsList(),e.interval=setInterval(function(){console.log("calling in interval"),e.getChatsList()},12e3))},function(t){console.log("error",t),e.loaded=!0}).catch(function(t){e.loaded=!0,console.log("error",t)})}},{key:"getChatsList",value:function(){var e=this;this.api.post_private("v1/chats/getById",{room_id:this.roomId}).then(function(t){console.log(t),e.loaded=!0,e.yourMessage=!0,t&&t.status&&200===t.status&&t.data.length&&(e.messages=t.data,e.scrollToBottom())},function(e){console.log(e)}).catch(function(e){console.log(e)})}},{key:"scrollToBottom",value:function(){console.log(this.scrollMe.nativeElement.scrollTop),this.scrollMe.nativeElement.scrollTop=this.scrollMe.nativeElement.scrollHeight,console.log(this.scrollMe.nativeElement.scrollTop)}},{key:"closeModal",value:function(){clearInterval(this.interval),this.basicModal.hide()}},{key:"sendMessage",value:function(){var e=this;if(console.log(this.msg),!this.msg||""===this.msg)return!1;var t=this.msg;this.msg="";var n={room_id:this.roomId,uid:this.uid,from_id:this.uid,message:t,message_type:0,status:1};this.scrollToBottom(),this.yourMessage=!1,this.api.post_private("v1/chats/sendMessage",n).then(function(t){console.log(t),e.yourMessage=!0,t&&200===t.status?e.getChatsList():e.yourMessage=!0},function(t){console.log(t),e.yourMessage=!0,e.util.apiErrorHandler(t)}).catch(function(t){console.log(t),e.yourMessage=!0,e.util.apiErrorHandler(t)})}}]),t}(),P.\u0275fac=function(e){return new(e||P)(l.\u0275\u0275directiveInject(d.s),l.\u0275\u0275directiveInject(s.f),l.\u0275\u0275directiveInject(r.F0))},P.\u0275cmp=l.\u0275\u0275defineComponent({type:P,selectors:[["app-chats"]],viewQuery:function(e,t){var n;1&e&&(l.\u0275\u0275viewQuery(p,5),l.\u0275\u0275viewQuery(g,5)),2&e&&(l.\u0275\u0275queryRefresh(n=l.\u0275\u0275loadQuery())&&(t.basicModal=n.first),l.\u0275\u0275queryRefresh(n=l.\u0275\u0275loadQuery())&&(t.scrollMe=n.first))},decls:32,vars:13,consts:[[1,"container"],["mdbModal","","tabindex","-1","role","dialog","aria-labelledby","myBasicModalLabel","aria-hidden","true",1,"modal","fade","bottom",2,"z-index","99999",3,"config"],["basicModal","mdbModal"],["role","document",1,"modal-dialog","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],["type","button","aria-label","Close",1,"close","pull-right",3,"click"],["aria-hidden","true"],["id","myModalLabel",1,"modal-title","w-100"],[1,"modal-body"],["style","display: flex;flex-direction: column;justify-content: center;align-items: center;",4,"ngIf"],[1,"main_content_div"],["scrollMe",""],[4,"ngFor","ngForOf"],["style","display: flex;flex-direction: row-reverse;padding: 20px;",4,"ngIf"],[1,"modal-footer"],[2,"width","100%"],[1,"md-form"],["type","text","id","form8","rows","1","mdbInput","",1,"md-textarea","form-control",3,"ngModel","ngModelChange"],["for","form8"],["type","button","mdbBtn","","color","secondary","aria-label","Close","mdbWavesEffect","",1,"waves-light",3,"click"],["type","button","mdbBtn","","color","primary","mdbWavesEffect","",1,"relative","waves-light",3,"click"],[1,"row"],["class","col-12 col-md-6","style","cursor: pointer;",3,"click",4,"ngIf"],["class","col-12 col-md-6","style","cursor: pointer;",4,"ngFor","ngForOf"],[2,"display","flex","flex-direction","column","justify-content","center","align-items","center"],["role","status",1,"spinner-border","text-success"],[1,"sr-only"],["class","left_div",4,"ngIf"],["class","right_div",4,"ngIf"],[1,"left_div"],[1,"inner_div"],[1,"msg_div"],[1,"right_div"],[2,"display","flex","flex-direction","row-reverse","padding","20px"],[1,"col-12","col-md-6",2,"cursor","pointer",3,"click"],[1,"boxed"],[1,"img_div",3,"ngStyle"],[1,"name"],[1,"col-12","col-md-6",2,"cursor","pointer"],["class","boxed",3,"click",4,"ngIf"],[1,"boxed",3,"click"],[1,"mbl"],[1,"row",2,"overflow","hidden"],["class","col-12 col-md-6",4,"ngFor","ngForOf"],[1,"col-12","col-md-6"],[3,"theme"]],template:function(e,t){1&e&&(l.\u0275\u0275elementStart(0,"div",0),l.\u0275\u0275elementStart(1,"div",1,2),l.\u0275\u0275elementStart(3,"div",3),l.\u0275\u0275elementStart(4,"div",4),l.\u0275\u0275elementStart(5,"div",5),l.\u0275\u0275elementStart(6,"button",6),l.\u0275\u0275listener("click",function(){return t.closeModal()}),l.\u0275\u0275elementStart(7,"span",7),l.\u0275\u0275text(8,"\xd7"),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(9,"h4",8),l.\u0275\u0275text(10),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(11,"div",9),l.\u0275\u0275template(12,v,4,1,"div",10),l.\u0275\u0275elementStart(13,"div",11,12),l.\u0275\u0275template(15,x,3,2,"span",13),l.\u0275\u0275elementEnd(),l.\u0275\u0275template(16,y,4,1,"div",14),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(17,"div",15),l.\u0275\u0275elementStart(18,"div",16),l.\u0275\u0275elementStart(19,"div",17),l.\u0275\u0275elementStart(20,"textarea",18),l.\u0275\u0275listener("ngModelChange",function(e){return t.msg=e}),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(21,"label",19),l.\u0275\u0275text(22),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(23,"div"),l.\u0275\u0275elementStart(24,"button",20),l.\u0275\u0275listener("click",function(){return t.closeModal()}),l.\u0275\u0275text(25),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(26,"button",21),l.\u0275\u0275listener("click",function(){return t.sendMessage()}),l.\u0275\u0275text(27),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(28,"div",22),l.\u0275\u0275template(29,b,5,3,"div",23),l.\u0275\u0275template(30,S,3,2,"div",24),l.\u0275\u0275elementEnd(),l.\u0275\u0275template(31,O,3,2,"div",13),l.\u0275\u0275elementEnd()),2&e&&(l.\u0275\u0275advance(1),l.\u0275\u0275property("config",l.\u0275\u0275pureFunction0(12,F)),l.\u0275\u0275advance(9),l.\u0275\u0275textInterpolate1(" ",t.name," "),l.\u0275\u0275advance(2),l.\u0275\u0275property("ngIf",!t.loaded),l.\u0275\u0275advance(3),l.\u0275\u0275property("ngForOf",t.messages),l.\u0275\u0275advance(1),l.\u0275\u0275property("ngIf",!t.yourMessage&&t.loaded),l.\u0275\u0275advance(4),l.\u0275\u0275property("ngModel",t.msg),l.\u0275\u0275advance(2),l.\u0275\u0275textInterpolate1(" ",t.util.translate("Type Here..")," "),l.\u0275\u0275advance(3),l.\u0275\u0275textInterpolate(t.util.translate("Close")),l.\u0275\u0275advance(2),l.\u0275\u0275textInterpolate(t.util.translate("Send Message")),l.\u0275\u0275advance(2),l.\u0275\u0275property("ngIf",t.util&&t.util.adminInfo&&t.util.adminInfo.id),l.\u0275\u0275advance(1),l.\u0275\u0275property("ngForOf",t.users),l.\u0275\u0275advance(1),l.\u0275\u0275property("ngForOf",t.dummy))},directives:[c.oB,a.NgIf,a.NgForOf,m.Fj,c.Hq,m.JJ,m.On,c.mT,c.b6,a.NgStyle,u.xr],styles:['@charset "UTF-8";.boxed[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}.boxed[_ngcontent-%COMP%]   .img_div[_ngcontent-%COMP%]{height:50px;width:50px;min-width:50px;background-position:center;background-repeat:no-repeat;background-size:contain;position:relative;margin:5px}.boxed[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:13px;font-family:"semi-bold";margin:0 0 0 20px}.main_content_div[_ngcontent-%COMP%]{width:100%;padding:15px}.main_content_div[_ngcontent-%COMP%]   .back_image[_ngcontent-%COMP%]{width:45px;height:45px;border-radius:100%;background-position:center;background-repeat:no-repeat;background-size:cover;min-width:45px}.main_content_div[_ngcontent-%COMP%]   .left_div[_ngcontent-%COMP%]{width:100%;display:flex;margin-bottom:15px}.main_content_div[_ngcontent-%COMP%]   .left_div[_ngcontent-%COMP%]   .inner_div[_ngcontent-%COMP%]{width:70%;display:flex;flex-direction:row;justify-content:flex-start}.main_content_div[_ngcontent-%COMP%]   .left_div[_ngcontent-%COMP%]   .msg_div[_ngcontent-%COMP%]{background:#f0eff5;display:flex;align-items:center;padding:10px 15px;border-radius:25px;margin-left:5px}.main_content_div[_ngcontent-%COMP%]   .right_div[_ngcontent-%COMP%]{display:flex;width:100%;margin-bottom:15px;justify-content:flex-end}.main_content_div[_ngcontent-%COMP%]   .right_div[_ngcontent-%COMP%]   .inner_div[_ngcontent-%COMP%]{width:70%;display:flex;flex-direction:row;justify-content:flex-end}.main_content_div[_ngcontent-%COMP%]   .right_div[_ngcontent-%COMP%]   .msg_div[_ngcontent-%COMP%]{background-color:#45c261!important;display:flex;align-items:center;padding:10px 15px;border-radius:25px;margin-right:5px;color:#fff}']}),P)}],L=function(){var t=n(function t(){e(this,t)});return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=l.\u0275\u0275defineInjector({imports:[[r.Bz.forChild(j)],r.Bz]}),t}(),B=o(44466),R=function(){var t=n(function t(){e(this,t)});return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=l.\u0275\u0275defineInjector({imports:[[a.CommonModule,L,B.m,c.yi.forRoot()]]}),t}()}}])}();