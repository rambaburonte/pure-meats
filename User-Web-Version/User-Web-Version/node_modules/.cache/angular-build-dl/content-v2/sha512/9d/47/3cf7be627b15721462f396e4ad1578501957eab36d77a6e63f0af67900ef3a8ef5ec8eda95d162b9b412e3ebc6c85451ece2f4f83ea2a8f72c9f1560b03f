"use strict";(self.webpackChunkgrocery_ultimate_web_initappz=self.webpackChunkgrocery_ultimate_web_initappz||[]).push([[249],{33249:function(e,t,n){n.r(t),n.d(t,{ChatsModule:function(){return j}});var i=n(38583),o=n(63318),a=n(37716),r=n(5830),l=n(67241),s=n(1078),d=n(90665),c=n(66357);const m=["basicModal"],p=["scrollMe"];function g(e,t){if(1&e&&(a.\u0275\u0275elementStart(0,"div",25),a.\u0275\u0275elementStart(1,"div",26),a.\u0275\u0275elementStart(2,"span",27),a.\u0275\u0275text(3),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd()),2&e){const e=a.\u0275\u0275nextContext();a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate(e.util.translate("Loading..."))}}function u(e,t){if(1&e&&(a.\u0275\u0275elementStart(0,"div",30),a.\u0275\u0275elementStart(1,"div",31),a.\u0275\u0275elementStart(2,"div",32),a.\u0275\u0275elementStart(3,"p"),a.\u0275\u0275text(4),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd()),2&e){const e=a.\u0275\u0275nextContext().$implicit;a.\u0275\u0275advance(4),a.\u0275\u0275textInterpolate(e.message)}}function h(e,t){if(1&e&&(a.\u0275\u0275elementStart(0,"div",33),a.\u0275\u0275elementStart(1,"div",31),a.\u0275\u0275elementStart(2,"div",32),a.\u0275\u0275elementStart(3,"p"),a.\u0275\u0275text(4),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd()),2&e){const e=a.\u0275\u0275nextContext().$implicit;a.\u0275\u0275advance(4),a.\u0275\u0275textInterpolate(e.message)}}function v(e,t){if(1&e&&(a.\u0275\u0275elementStart(0,"span"),a.\u0275\u0275template(1,u,5,1,"div",28),a.\u0275\u0275template(2,h,5,1,"div",29),a.\u0275\u0275elementEnd()),2&e){const e=t.$implicit,n=a.\u0275\u0275nextContext();a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",e.from_id!=n.uid),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",e.from_id==n.uid)}}function f(e,t){if(1&e&&(a.\u0275\u0275elementStart(0,"div",34),a.\u0275\u0275elementStart(1,"div",26),a.\u0275\u0275elementStart(2,"span",27),a.\u0275\u0275text(3),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd()),2&e){const e=a.\u0275\u0275nextContext();a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate(e.util.translate("Loading..."))}}const x=function(){return{"background-image":"url(assets/placeholder.png)"}};function _(e,t){if(1&e){const e=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",35),a.\u0275\u0275listener("click",function(){return a.\u0275\u0275restoreView(e),a.\u0275\u0275nextContext().onAdmin()}),a.\u0275\u0275elementStart(1,"div",36),a.\u0275\u0275element(2,"div",37),a.\u0275\u0275elementStart(3,"p",38),a.\u0275\u0275text(4),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd()}if(2&e){const e=a.\u0275\u0275nextContext();a.\u0275\u0275advance(2),a.\u0275\u0275property("ngStyle",a.\u0275\u0275pureFunction0(2,x)),a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate1(" ",e.util.translate("Support")," ")}}const y=function(e){return{"background-image":e}};function C(e,t){if(1&e){const e=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",41),a.\u0275\u0275listener("click",function(){a.\u0275\u0275restoreView(e);const t=a.\u0275\u0275nextContext().$implicit;return a.\u0275\u0275nextContext().onChat(t.participants,t.receiver_type,t.receiver_name+" "+t.receiver_last_name)}),a.\u0275\u0275element(1,"div",37),a.\u0275\u0275elementStart(2,"p",38),a.\u0275\u0275text(3),a.\u0275\u0275element(4,"br"),a.\u0275\u0275elementStart(5,"span",42),a.\u0275\u0275text(6),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd()}if(2&e){const e=a.\u0275\u0275nextContext().$implicit,t=a.\u0275\u0275nextContext();a.\u0275\u0275advance(1),a.\u0275\u0275property("ngStyle",a.\u0275\u0275pureFunction1(3,y,"url("+t.api.mediaURL+e.receiver_cover+")")),a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate1(" ",e.receiver_name+" "+e.receiver_last_name," "),a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate(e.receiver_type)}}function b(e,t){if(1&e){const e=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",41),a.\u0275\u0275listener("click",function(){a.\u0275\u0275restoreView(e);const t=a.\u0275\u0275nextContext().$implicit;return a.\u0275\u0275nextContext().onChat(t.uid,t.sender_type,t.sender_first_name+" "+t.sender_last_name)}),a.\u0275\u0275element(1,"div",37),a.\u0275\u0275elementStart(2,"p",38),a.\u0275\u0275text(3),a.\u0275\u0275element(4,"br"),a.\u0275\u0275elementStart(5,"span",42),a.\u0275\u0275text(6),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd()}if(2&e){const e=a.\u0275\u0275nextContext().$implicit,t=a.\u0275\u0275nextContext();a.\u0275\u0275advance(1),a.\u0275\u0275property("ngStyle",a.\u0275\u0275pureFunction1(3,y,"url("+t.api.mediaURL+e.sender_cover+")")),a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate1(" ",e.sender_first_name+" "+e.sender_last_name," "),a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate(e.sender_type)}}function M(e,t){if(1&e&&(a.\u0275\u0275elementStart(0,"div",39),a.\u0275\u0275template(1,C,7,5,"div",40),a.\u0275\u0275template(2,b,7,5,"div",40),a.\u0275\u0275elementEnd()),2&e){const e=t.$implicit,n=a.\u0275\u0275nextContext();a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",n.uid==e.uid),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",n.uid!=e.uid)}}const E=function(){return{"border-radius":"5px",height:"120px",width:"100%"}};function S(e,t){1&e&&(a.\u0275\u0275elementStart(0,"div",45),a.\u0275\u0275element(1,"ngx-skeleton-loader",46),a.\u0275\u0275elementEnd()),2&e&&(a.\u0275\u0275advance(1),a.\u0275\u0275property("theme",a.\u0275\u0275pureFunction0(1,E)))}const I=function(){return[1,2,3,4,5,6,7,8]};function w(e,t){1&e&&(a.\u0275\u0275elementStart(0,"div"),a.\u0275\u0275elementStart(1,"div",43),a.\u0275\u0275template(2,S,2,2,"div",44),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd()),2&e&&(a.\u0275\u0275advance(2),a.\u0275\u0275property("ngForOf",a.\u0275\u0275pureFunction0(1,I)))}const O=function(){return{backdrop:!0,ignoreBackdropClick:!0}},k=[{path:"",component:(()=>{class e{constructor(e,t,n){this.api=e,this.util=t,this.router=n,this.dummy=[],this.users=[],this.msg="",this.messages=[],this.receiver_id="",this.roomId="",this.uid=parseInt(localStorage.getItem("uid")),this.getChats()}ngOnInit(){}getChats(){this.dummy=Array(10),this.api.post_private("v1/chats/getChatListBUid",{id:this.uid}).then(e=>{console.log(e),this.dummy=[],e&&e.status&&e.data&&e.data.length&&(this.users=e.data,console.log("users",this.users))},e=>{console.log(e),this.dummy=[],this.util.apiErrorHandler(e)}).catch(e=>{console.log(e),this.dummy=[],this.util.apiErrorHandler(e)})}onAdmin(){this.messages=[],this.receiver_id=this.util.adminInfo.id,this.name=this.util.adminInfo.first_name+" "+this.util.adminInfo.last_name,this.getInbox(),this.loaded=!1,this.basicModal.show()}onChat(e,t,n){console.log(e,t,n),this.messages=[],this.receiver_id=e,this.name=n,this.getInbox(),this.loaded=!1,this.basicModal.show()}getInbox(){this.api.post_private("v1/chats/getChatRooms",{uid:this.uid,participants:this.receiver_id}).then(e=>{console.log(e),e&&e.status&&200===e.status?(e&&e.data&&e.data.id?this.roomId=e.data.id:e&&e.data2&&e.data2.id&&(this.roomId=e.data2.id),this.interval=setInterval(()=>{console.log("calling in interval"),this.getChatsList()},12e3),this.getChatsList()):this.createChatRooms()},e=>{console.log("error",e),this.loaded=!1,this.createChatRooms()}).catch(e=>{this.loaded=!1,this.createChatRooms(),console.log("error",e)})}createChatRooms(){this.api.post_private("v1/chats/createChatRooms",{uid:this.uid,participants:this.receiver_id,status:1}).then(e=>{console.log(e),this.loaded=!0,e&&e.status&&200===e.status&&e.data&&(this.roomId=e.data.id,this.getChatsList(),this.interval=setInterval(()=>{console.log("calling in interval"),this.getChatsList()},12e3))},e=>{console.log("error",e),this.loaded=!0}).catch(e=>{this.loaded=!0,console.log("error",e)})}getChatsList(){this.api.post_private("v1/chats/getById",{room_id:this.roomId}).then(e=>{console.log(e),this.loaded=!0,this.yourMessage=!0,e&&e.status&&200===e.status&&e.data.length&&(this.messages=e.data,this.scrollToBottom())},e=>{console.log(e)}).catch(e=>{console.log(e)})}scrollToBottom(){console.log(this.scrollMe.nativeElement.scrollTop),this.scrollMe.nativeElement.scrollTop=this.scrollMe.nativeElement.scrollHeight,console.log(this.scrollMe.nativeElement.scrollTop)}closeModal(){clearInterval(this.interval),this.basicModal.hide()}sendMessage(){if(console.log(this.msg),!this.msg||""===this.msg)return!1;const e=this.msg;this.msg="";const t={room_id:this.roomId,uid:this.uid,from_id:this.uid,message:e,message_type:0,status:1};this.scrollToBottom(),this.yourMessage=!1,this.api.post_private("v1/chats/sendMessage",t).then(e=>{console.log(e),this.yourMessage=!0,e&&200===e.status?this.getChatsList():this.yourMessage=!0},e=>{console.log(e),this.yourMessage=!0,this.util.apiErrorHandler(e)}).catch(e=>{console.log(e),this.yourMessage=!0,this.util.apiErrorHandler(e)})}}return e.\u0275fac=function(t){return new(t||e)(a.\u0275\u0275directiveInject(r.s),a.\u0275\u0275directiveInject(l.f),a.\u0275\u0275directiveInject(o.F0))},e.\u0275cmp=a.\u0275\u0275defineComponent({type:e,selectors:[["app-chats"]],viewQuery:function(e,t){if(1&e&&(a.\u0275\u0275viewQuery(m,5),a.\u0275\u0275viewQuery(p,5)),2&e){let e;a.\u0275\u0275queryRefresh(e=a.\u0275\u0275loadQuery())&&(t.basicModal=e.first),a.\u0275\u0275queryRefresh(e=a.\u0275\u0275loadQuery())&&(t.scrollMe=e.first)}},decls:32,vars:13,consts:[[1,"container"],["mdbModal","","tabindex","-1","role","dialog","aria-labelledby","myBasicModalLabel","aria-hidden","true",1,"modal","fade","bottom",2,"z-index","99999",3,"config"],["basicModal","mdbModal"],["role","document",1,"modal-dialog","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],["type","button","aria-label","Close",1,"close","pull-right",3,"click"],["aria-hidden","true"],["id","myModalLabel",1,"modal-title","w-100"],[1,"modal-body"],["style","display: flex;flex-direction: column;justify-content: center;align-items: center;",4,"ngIf"],[1,"main_content_div"],["scrollMe",""],[4,"ngFor","ngForOf"],["style","display: flex;flex-direction: row-reverse;padding: 20px;",4,"ngIf"],[1,"modal-footer"],[2,"width","100%"],[1,"md-form"],["type","text","id","form8","rows","1","mdbInput","",1,"md-textarea","form-control",3,"ngModel","ngModelChange"],["for","form8"],["type","button","mdbBtn","","color","secondary","aria-label","Close","mdbWavesEffect","",1,"waves-light",3,"click"],["type","button","mdbBtn","","color","primary","mdbWavesEffect","",1,"relative","waves-light",3,"click"],[1,"row"],["class","col-12 col-md-6","style","cursor: pointer;",3,"click",4,"ngIf"],["class","col-12 col-md-6","style","cursor: pointer;",4,"ngFor","ngForOf"],[2,"display","flex","flex-direction","column","justify-content","center","align-items","center"],["role","status",1,"spinner-border","text-success"],[1,"sr-only"],["class","left_div",4,"ngIf"],["class","right_div",4,"ngIf"],[1,"left_div"],[1,"inner_div"],[1,"msg_div"],[1,"right_div"],[2,"display","flex","flex-direction","row-reverse","padding","20px"],[1,"col-12","col-md-6",2,"cursor","pointer",3,"click"],[1,"boxed"],[1,"img_div",3,"ngStyle"],[1,"name"],[1,"col-12","col-md-6",2,"cursor","pointer"],["class","boxed",3,"click",4,"ngIf"],[1,"boxed",3,"click"],[1,"mbl"],[1,"row",2,"overflow","hidden"],["class","col-12 col-md-6",4,"ngFor","ngForOf"],[1,"col-12","col-md-6"],[3,"theme"]],template:function(e,t){1&e&&(a.\u0275\u0275elementStart(0,"div",0),a.\u0275\u0275elementStart(1,"div",1,2),a.\u0275\u0275elementStart(3,"div",3),a.\u0275\u0275elementStart(4,"div",4),a.\u0275\u0275elementStart(5,"div",5),a.\u0275\u0275elementStart(6,"button",6),a.\u0275\u0275listener("click",function(){return t.closeModal()}),a.\u0275\u0275elementStart(7,"span",7),a.\u0275\u0275text(8,"\xd7"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(9,"h4",8),a.\u0275\u0275text(10),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(11,"div",9),a.\u0275\u0275template(12,g,4,1,"div",10),a.\u0275\u0275elementStart(13,"div",11,12),a.\u0275\u0275template(15,v,3,2,"span",13),a.\u0275\u0275elementEnd(),a.\u0275\u0275template(16,f,4,1,"div",14),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(17,"div",15),a.\u0275\u0275elementStart(18,"div",16),a.\u0275\u0275elementStart(19,"div",17),a.\u0275\u0275elementStart(20,"textarea",18),a.\u0275\u0275listener("ngModelChange",function(e){return t.msg=e}),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(21,"label",19),a.\u0275\u0275text(22),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(23,"div"),a.\u0275\u0275elementStart(24,"button",20),a.\u0275\u0275listener("click",function(){return t.closeModal()}),a.\u0275\u0275text(25),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(26,"button",21),a.\u0275\u0275listener("click",function(){return t.sendMessage()}),a.\u0275\u0275text(27),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(28,"div",22),a.\u0275\u0275template(29,_,5,3,"div",23),a.\u0275\u0275template(30,M,3,2,"div",24),a.\u0275\u0275elementEnd(),a.\u0275\u0275template(31,w,3,2,"div",13),a.\u0275\u0275elementEnd()),2&e&&(a.\u0275\u0275advance(1),a.\u0275\u0275property("config",a.\u0275\u0275pureFunction0(12,O)),a.\u0275\u0275advance(9),a.\u0275\u0275textInterpolate1(" ",t.name," "),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",!t.loaded),a.\u0275\u0275advance(3),a.\u0275\u0275property("ngForOf",t.messages),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",!t.yourMessage&&t.loaded),a.\u0275\u0275advance(4),a.\u0275\u0275property("ngModel",t.msg),a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate1(" ",t.util.translate("Type Here..")," "),a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate(t.util.translate("Close")),a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(t.util.translate("Send Message")),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",t.util&&t.util.adminInfo&&t.util.adminInfo.id),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngForOf",t.users),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngForOf",t.dummy))},directives:[s.oB,i.NgIf,i.NgForOf,d.Fj,s.Hq,d.JJ,d.On,s.mT,s.b6,i.NgStyle,c.xr],styles:['@charset "UTF-8";.boxed[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}.boxed[_ngcontent-%COMP%]   .img_div[_ngcontent-%COMP%]{height:50px;width:50px;min-width:50px;background-position:center;background-repeat:no-repeat;background-size:contain;position:relative;margin:5px}.boxed[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:13px;font-family:"semi-bold";margin:0 0 0 20px}.main_content_div[_ngcontent-%COMP%]{width:100%;padding:15px}.main_content_div[_ngcontent-%COMP%]   .back_image[_ngcontent-%COMP%]{width:45px;height:45px;border-radius:100%;background-position:center;background-repeat:no-repeat;background-size:cover;min-width:45px}.main_content_div[_ngcontent-%COMP%]   .left_div[_ngcontent-%COMP%]{width:100%;display:flex;margin-bottom:15px}.main_content_div[_ngcontent-%COMP%]   .left_div[_ngcontent-%COMP%]   .inner_div[_ngcontent-%COMP%]{width:70%;display:flex;flex-direction:row;justify-content:flex-start}.main_content_div[_ngcontent-%COMP%]   .left_div[_ngcontent-%COMP%]   .msg_div[_ngcontent-%COMP%]{background:#f0eff5;display:flex;align-items:center;padding:10px 15px;border-radius:25px;margin-left:5px}.main_content_div[_ngcontent-%COMP%]   .right_div[_ngcontent-%COMP%]{display:flex;width:100%;margin-bottom:15px;justify-content:flex-end}.main_content_div[_ngcontent-%COMP%]   .right_div[_ngcontent-%COMP%]   .inner_div[_ngcontent-%COMP%]{width:70%;display:flex;flex-direction:row;justify-content:flex-end}.main_content_div[_ngcontent-%COMP%]   .right_div[_ngcontent-%COMP%]   .msg_div[_ngcontent-%COMP%]{background-color:#45c261!important;display:flex;align-items:center;padding:10px 15px;border-radius:25px;margin-right:5px;color:#fff}']}),e})()}];let P=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=a.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=a.\u0275\u0275defineInjector({imports:[[o.Bz.forChild(k)],o.Bz]}),e})();var F=n(44466);let j=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=a.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=a.\u0275\u0275defineInjector({imports:[[i.CommonModule,P,F.m,s.yi.forRoot()]]}),e})()}}]);